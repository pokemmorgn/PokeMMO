!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t["@colyseus/httpie"]={})}(this,(function(t){const{request:e}=require("https"),{globalAgent:o}=require("http"),{parse:n,resolve:s}=require("url");function r(t,e,o){(o=o||new Error(e.statusMessage)).statusMessage=e.statusMessage,o.statusCode=e.statusCode,o.headers=e.headers,o.data=e.data,t(o)}function a(t,i,d={}){return new Promise((u,p)=>{let c,f,h,b=!1,l="",{redirect:y=!0}=d;d.method=t,i&&i.toJSON&&(i=i.toJSON()),Object.assign(d,"string"==typeof i?n(i):i),d.agent="http:"===d.protocol?o:void 0,c=e(d,e=>{if(e.statusCode>300&&y&&e.headers.location)return d.path=s(d.path,e.headers.location),a(t,d.path.startsWith("/")?d:d.path,d).then(u,p);e.on("data",t=>{l+=t}),e.on("end",()=>{if(f=e.headers["content-type"],f&&l&&f.includes("application/json"))try{l=JSON.parse(l,d.reviver)}catch(t){return r(p,e,t)}e.data=l,e.statusCode>=400?r(p,e):u(e)})}),c.on("timeout",(function(){b=!0,c.abort()})),c.on("error",t=>{t.timeout=b,t.aborted=h,p(t)}),d.signal&&d.signal.addEventListener("abort",(function(){h=!0,c.destroy()})),d.body&&(f="object"==typeof d.body&&!Buffer.isBuffer(d.body),f&&c.setHeader("content-type","application/json"),f=f?JSON.stringify(d.body):d.body,c.setHeader("content-length",Buffer.byteLength(f)),c.write(f)),c.end()})}const i=a.bind(a,"GET"),d=a.bind(a,"POST"),u=a.bind(a,"PATCH"),p=a.bind(a,"DELETE"),c=a.bind(a,"PUT");t.del=p,t.get=i,t.patch=u,t.post=d,t.put=c,t.send=a}));