<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Debug Sui Wallet</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #000;
            color: #0f0;
        }
        button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 10px;
            margin: 5px;
            cursor: pointer;
        }
        .log {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #0f0;
        }
        .error { color: #f00; border-color: #f00; }
        .success { color: #0f0; border-color: #0f0; }
        .info { color: #ff0; border-color: #ff0; }
        pre {
            background: #111;
            padding: 10px;
            overflow: auto;
        }
    </style>
</head>
<body>
    <h1>üîç Debug Sui Wallet</h1>
    <div id="logs"></div>

    <button onclick="checkEverything()">üîç Tout v√©rifier</button>
    <button onclick="forceConnect()">‚ö° Forcer connexion</button>
    <button onclick="checkExtension()">üß© V√©rifier extension</button>
    <button onclick="location.reload()">üîÑ Rafra√Æchir</button>

    <script>
        const log = (msg, type = 'info') => {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${msg}`;
            document.getElementById('logs').appendChild(div);
            console.log(msg);
        };

        // Check imm√©diat
        log('üöÄ D√©marrage du d√©bogage...', 'info');

        function checkEverything() {
            log('=== V√âRIFICATION COMPL√àTE ===', 'info');
            
            // 1. Check direct
            log('1Ô∏è‚É£ V√©rification directe:', 'info');
            log(`window.sui: ${typeof window.sui}`, window.sui ? 'success' : 'error');
            log(`window.suiWallet: ${typeof window.suiWallet}`, window.suiWallet ? 'success' : 'error');
            log(`window.SuiWallet: ${typeof window.SuiWallet}`, window.SuiWallet ? 'success' : 'error');
            
            // 2. Check wallet-standard
            log('2Ô∏è‚É£ V√©rification wallet-standard:', 'info');
            if (window['wallet-standard']) {
                log('wallet-standard trouv√©!', 'success');
                const ws = window['wallet-standard'];
                log(`Propri√©t√©s: ${Object.keys(ws).join(', ')}`, 'info');
            } else {
                log('wallet-standard non trouv√©', 'error');
            }
            
            // 3. Recherche globale
            log('3Ô∏è‚É£ Recherche globale Sui:', 'info');
            const suiObjects = [];
            for (let key in window) {
                if (key.toLowerCase().includes('sui') || key.toLowerCase().includes('wallet')) {
                    suiObjects.push(key);
                }
            }
            if (suiObjects.length > 0) {
                log(`Objets trouv√©s: ${suiObjects.join(', ')}`, 'success');
                
                // Examiner chaque objet
                suiObjects.forEach(key => {
                    try {
                        const obj = window[key];
                        if (obj && typeof obj === 'object') {
                            log(`${key}: ${JSON.stringify(Object.keys(obj)).substring(0, 100)}...`, 'info');
                        }
                    } catch (e) {}
                });
            } else {
                log('Aucun objet Sui ou wallet d√©tect√© dans window', 'error');
            }
            
            // 4. Check des √©v√©nements
            log('4Ô∏è‚É£ Test des √©v√©nements:', 'info');
            const testEvent = new Event('wallet-standard:app-ready');
            window.dispatchEvent(testEvent);
            
            // 5. Injection manuelle
            log('5Ô∏è‚É£ Tentative d\'acc√®s via l\'API standard:', 'info');
            checkWalletStandard();
        }

        function checkWalletStandard() {
            // Nouvelle API wallet-standard
            if (window['wallet-standard']) {
                const { get } = window['wallet-standard'];
                if (typeof get === 'function') {
                    const wallets = get();
                    if (wallets && wallets.length) {
                        log(`Wallets trouv√©s via standard: ${wallets.length}`, 'success');
                        wallets.forEach((wallet, i) => {
                            log(`Wallet ${i}: ${wallet.name} - ${wallet.chains?.join(', ')}`, 'info');
                            if (wallet.chains?.includes('sui:mainnet') || wallet.chains?.includes('sui:devnet')) {
                                log('‚úÖ Wallet Sui trouv√©!', 'success');
                                window.detectedSuiWallet = wallet;
                            }
                        });
                    } else {
                        log('Aucun wallet retourn√© par wallet-standard.get()', 'error');
                    }
                } else {
                    log('wallet-standard.get() n\'est pas une fonction', 'error');
                }
            } else {
                log('wallet-standard non disponible', 'error');
            }
        }

        async function forceConnect() {
            log('‚ö° Tentative de connexion forc√©e...', 'info');
            
            // Essayer toutes les m√©thodes possibles
            const attempts = [
                { name: 'window.sui', obj: window.sui },
                { name: 'window.suiWallet', obj: window.suiWallet },
                { name: 'window.SuiWallet', obj: window.SuiWallet },
                { name: 'detected wallet', obj: window.detectedSuiWallet }
            ];
            
            for (const attempt of attempts) {
                if (attempt.obj) {
                    log(`Tentative avec ${attempt.name}...`, 'info');
                    try {
                        // Essayer requestPermissions
                        if (attempt.obj.requestPermissions) {
                            const perms = await attempt.obj.requestPermissions();
                            log(`‚úÖ Permissions obtenues: ${JSON.stringify(perms)}`, 'success');
                        }
                        
                        // Essayer getAccounts
                        if (attempt.obj.getAccounts) {
                            const accounts = await attempt.obj.getAccounts();
                            log(`‚úÖ Comptes: ${JSON.stringify(accounts)}`, 'success');
                            return;
                        }
                        
                        // Essayer connect (wallet-standard)
                        if (attempt.obj.features && attempt.obj.features['standard:connect']) {
                            const connectFeature = attempt.obj.features['standard:connect'];
                            const result = await connectFeature.connect();
                            log(`‚úÖ Connect√© via standard: ${JSON.stringify(result)}`, 'success');
                            return;
                        }
                    } catch (e) {
                        log(`‚ùå Erreur ${attempt.name}: ${e.message}`, 'error');
                    }
                }
            }
            
            log('‚ùå Aucune m√©thode de connexion n\'a fonctionn√©', 'error');
        }

        function checkExtension() {
            log('üß© V√©rification de l\'extension...', 'info');
            
            // Cr√©er une iframe pour v√©rifier
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = 'chrome-extension://opcgpfmipidbgpenhmajoajpbobppdil/favicon.ico';
            iframe.onload = () => {
                log('‚úÖ Extension d√©tect√©e via favicon', 'success');
                iframe.remove();
            };
            iframe.onerror = () => {
                log('‚ùå Extension non accessible', 'error');
                iframe.remove();
            };
            document.body.appendChild(iframe);
            
            // V√©rifier aussi via fetch
            fetch('chrome-extension://opcgpfmipidbgpenhmajoajpbobppdil/manifest.json')
                .then(() => log('‚úÖ Manifest accessible', 'success'))
                .catch(() => log('‚ùå Manifest non accessible - Normal si l\'extension a des restrictions', 'info'));
        }

        // Attendre et rev√©rifier
        let checkCount = 0;
        const interval = setInterval(() => {
            checkCount++;
            const found = window.sui || window.suiWallet || window.SuiWallet;
            if (found) {
                log(`‚úÖ Wallet trouv√© apr√®s ${checkCount} secondes!`, 'success');
                clearInterval(interval);
                checkEverything();
            } else if (checkCount >= 10) {
                log('‚è±Ô∏è Timeout apr√®s 10 secondes', 'error');
                clearInterval(interval);
            }
        }, 1000);

        // √âcouter tous les √©v√©nements possibles
        const events = [
            'wallet-standard:app-ready',
            'wallet-standard:register-wallet',
            'sui-wallet-ready',
            'DOMContentLoaded',
            'load'
        ];

        events.forEach(event => {
            window.addEventListener(event, () => {
                log(`üì° Event re√ßu: ${event}`, 'info');
                setTimeout(checkEverything, 100);
            });
        });

        // Check initial apr√®s un d√©lai
        setTimeout(checkEverything, 2000);
    </script>
</body>
</html>