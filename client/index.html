<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PokeWorld - Multiplayer Game</title>
  <style>
    body {
      background-color: black;
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    #chat-window {
      position: fixed;
      bottom: 20px;
      left: 20px;
      width: 450px;
      height: 300px;
      background: linear-gradient(145deg, rgba(25, 30, 45, 0.95), rgba(15, 20, 35, 0.95));
      border: 2px solid rgba(100, 150, 255, 0.3);
      border-radius: 16px;
      display: flex;
      flex-direction: column;
      z-index: 2000;
      font-family: 'Segoe UI', 'Arial', sans-serif;
      box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.4),
        0 0 0 1px rgba(255, 255, 255, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    #chat-window.minimized {
      height: 50px;
      width: 200px;
    }

    #chat-window.minimized #chat-messages,
    #chat-window.minimized #typing-indicator,
    #chat-window.minimized #chat-input-container {
      display: none !important;
    }

    #chat-window.minimized #chat-header {
      cursor: pointer;
    }

    #chat-window.minimized #chat-header:hover {
      background: linear-gradient(90deg, 
        rgba(120, 170, 255, 0.25) 0%, 
        rgba(170, 120, 255, 0.25) 50%, 
        rgba(120, 170, 255, 0.25) 100%);
    }

    #chat-window.hidden {
      transform: translateX(-100%);
      opacity: 0;
    }

    #chat-toggle {
      position: fixed;
      bottom: 180px;
      left: -40px;
      width: 50px;
      height: 80px;
      background: linear-gradient(145deg, rgba(25, 30, 45, 0.95), rgba(15, 20, 35, 0.95));
      border: 2px solid rgba(100, 150, 255, 0.3);
      border-left: none;
      border-radius: 0 16px 16px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1999;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(10px);
      opacity: 0;
      pointer-events: none;
    }

    #chat-toggle.show {
      left: 0;
      opacity: 1;
      pointer-events: auto;
    }

    #chat-toggle:hover {
      background: linear-gradient(145deg, rgba(35, 40, 55, 0.95), rgba(25, 30, 45, 0.95));
      border-color: rgba(100, 150, 255, 0.5);
      transform: translateX(10px);
    }

    #chat-toggle-icon {
      color: rgba(255, 255, 255, 0.8);
      font-size: 18px;
      transform: rotate(0deg);
      transition: all 0.3s ease;
    }

    #chat-toggle:hover #chat-toggle-icon {
      color: #64a6ff;
      transform: rotate(360deg) scale(1.1);
    }

    #chat-header {
      position: relative;
      top: 0;
      left: 0;
      right: 0;
      height: 40px;
      background: linear-gradient(90deg, 
        rgba(100, 150, 255, 0.2) 0%, 
        rgba(150, 100, 255, 0.2) 50%, 
        rgba(100, 150, 255, 0.2) 100%);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      font-size: 14px;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.9);
      z-index: 10;
      flex-shrink: 0;
      cursor: pointer;
    }

    #chat-title {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    #chat-controls {
      display: flex;
      gap: 8px;
    }

    .chat-btn {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 6px;
      color: rgba(255, 255, 255, 0.8);
      cursor: pointer;
      padding: 4px 8px;
      font-size: 12px;
      transition: all 0.2s ease;
    }

    .chat-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      transform: scale(1.05);
    }

    #online-count {
      background: rgba(34, 197, 94, 0.2);
      color: #22c55e;
      border: 1px solid rgba(34, 197, 94, 0.3);
      border-radius: 12px;
      padding: 2px 8px;
      font-size: 11px;
      font-weight: 500;
    }

    #chat-messages {
      flex: 1;
      padding: 8px 16px;
      overflow-y: auto;
      color: #eee;
      font-size: 14px;
      line-height: 1.4;
      scrollbar-width: thin;
      scrollbar-color: rgba(100, 150, 255, 0.5) transparent;
    }

    #chat-messages::-webkit-scrollbar {
      width: 6px;
    }

    #chat-messages::-webkit-scrollbar-track {
      background: transparent;
    }

    #chat-messages::-webkit-scrollbar-thumb {
      background: rgba(100, 150, 255, 0.5);
      border-radius: 3px;
    }

    #chat-messages::-webkit-scrollbar-thumb:hover {
      background: rgba(100, 150, 255, 0.7);
    }

    .chat-message {
      margin-bottom: 6px;
      padding: 6px 10px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
      border-left: 3px solid rgba(100, 150, 255, 0.6);
      transition: all 0.2s ease;
      font-size: 13px;
      position: relative;
      overflow: hidden;
    }

    .chat-message:hover {
      background: rgba(255, 255, 255, 0.08);
      transform: translateX(2px);
    }

    .chat-message.system {
      border-left-color: rgba(34, 197, 94, 0.6);
      background: rgba(34, 197, 94, 0.1);
      font-style: italic;
    }

    .chat-message.battle {
      border-left-color: rgba(239, 68, 68, 0.6);
      background: rgba(239, 68, 68, 0.1);
    }

    .chat-message.trade {
      border-left-color: rgba(245, 158, 11, 0.6);
      background: rgba(245, 158, 11, 0.1);
    }

    .chat-username {
      font-weight: 600;
      color: #64a6ff;
      margin-right: 8px;
      text-shadow: 0 0 8px rgba(100, 166, 255, 0.3);
      cursor: pointer;
    }

    .chat-username:hover {
      color: #80b8ff;
      text-shadow: 0 0 12px rgba(100, 166, 255, 0.5);
    }

    .chat-username.level::after {
      content: attr(data-level);
      background: linear-gradient(45deg, #ffd700, #ffed4a);
      color: #1a1a1a;
      font-size: 9px;
      font-weight: bold;
      padding: 1px 4px;
      border-radius: 8px;
      margin-left: 4px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    .chat-text {
      color: #f0f0f0;
    }

    .chat-timestamp {
      font-size: 10px;
      color: rgba(255, 255, 255, 0.4);
      float: right;
      margin-top: 2px;
    }

    .pokemon-emoji {
      font-size: 16px;
      margin: 0 2px;
      display: inline-block;
      animation: bounce 0.5s ease-in-out;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-2px); }
    }

    #chat-input-container {
      position: relative;
      display: flex;
      align-items: center;
    }

    #chat-input {
      border: none;
      padding: 10px 50px 10px 16px;
      background: rgba(40, 50, 70, 0.8);
      color: #fff;
      border-radius: 0 0 14px 14px;
      outline: none;
      font-size: 14px;
      width: calc(100% - 66px);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
      position: relative;
      height: 20px;
    }

    #chat-input:focus {
      background: rgba(50, 60, 80, 0.9);
      box-shadow: 0 0 0 2px rgba(100, 150, 255, 0.5);
    }

    #chat-input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    #char-counter {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 11px;
      color: rgba(255, 255, 255, 0.4);
      pointer-events: none;
    }

    #char-counter.warning {
      color: #f59e0b;
    }

    #char-counter.danger {
      color: #ef4444;
    }

    #typing-indicator {
      position: relative;
      padding: 4px 16px 0 16px;
      font-size: 11px;
      color: rgba(255, 255, 255, 0.6);
      font-style: italic;
      opacity: 0;
      transition: opacity 0.3s ease;
      height: 0;
      overflow: hidden;
      background: rgba(255, 255, 255, 0.02);
      border-top: 1px solid rgba(255, 255, 255, 0.05);
    }

    #typing-indicator.show {
      opacity: 1;
      height: 20px;
      padding: 4px 16px;
    }

    .typing-dots {
      display: inline-block;
    }

    .typing-dots::after {
      content: '...';
      animation: typing 1.5s infinite;
    }

    @keyframes typing {
      0%, 60% { content: '...'; }
      20% { content: '.'; }
      40% { content: '..'; }
    }

    /* Animation d'apparition des messages */
    @keyframes messageAppear {
      from {
        opacity: 0;
        transform: translateY(10px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .chat-message.new {
      animation: messageAppear 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes messageLeave {
      from {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
      to {
        opacity: 0;
        transform: translateY(-10px) scale(0.95);
      }
    }

    .chat-message.leaving {
      animation: messageLeave 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Sound wave animation for chat activity */
    .sound-wave {
      display: inline-block;
      width: 3px;
      height: 3px;
      background: #22c55e;
      border-radius: 50%;
      margin: 0 1px;
      animation: soundWave 1s infinite ease-in-out;
    }

    .sound-wave:nth-child(2) { animation-delay: 0.1s; }
    .sound-wave:nth-child(3) { animation-delay: 0.2s; }

    @keyframes soundWave {
      0%, 100% { transform: scaleY(1); opacity: 0.5; }
      50% { transform: scaleY(1.5); opacity: 1; }
    }

    /* Style pour la bo√Æte de dialogue NPC */
    #dialogue-box {
      position: absolute;
      bottom: 120px;
      left: 50%;
      transform: translateX(-50%);
      min-width: 500px;
      max-width: 750px;
      background: linear-gradient(145deg, rgba(36, 76, 116, 0.95), rgba(25, 55, 95, 0.95));
      border: 3px solid rgba(255, 255, 255, 0.8);
      border-radius: 20px;
      box-shadow: 
        0 8px 40px rgba(0, 0, 0, 0.6),
        0 0 0 1px rgba(255, 255, 255, 0.2),
        inset 0 2px 0 rgba(255, 255, 255, 0.3);
      display: flex;
      flex-direction: row;
      align-items: flex-end;
      z-index: 99;
      font-family: 'Arial Rounded MT Bold', Arial, sans-serif;
      backdrop-filter: blur(8px);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    #dialogue-box:hover {
      transform: translateX(-50%) scale(1.02);
      box-shadow: 
        0 12px 50px rgba(0, 0, 0, 0.7),
        0 0 0 1px rgba(255, 255, 255, 0.3),
        inset 0 2px 0 rgba(255, 255, 255, 0.4);
    }

    #npc-portrait {
      width: 100px;
      height: 100px;
      background: linear-gradient(145deg, #fff, #f0f0f0);
      border: 3px solid rgba(36, 76, 116, 0.8);
      border-radius: 16px;
      margin: 14px;
      overflow: hidden;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 
        0 4px 16px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }

    #npc-portrait img {
      max-width: 100%;
      max-height: 100%;
      border-radius: 12px;
    }

    #npc-dialogue {
      flex: 1;
      padding: 16px 20px 16px 0;
      display: flex;
      flex-direction: column;
    }

    #npc-name {
      font-weight: bold;
      font-size: 19px;
      color: #ffff80;
      margin-bottom: 10px;
      text-shadow: 
        1px 2px 0 #222, 
        0 0 12px rgba(241, 241, 145, 0.8),
        0 0 24px rgba(241, 241, 145, 0.4);
    }

    #npc-text {
      color: #fff;
      font-size: 16px;
      text-shadow: 1px 1px 0 #222, 0 0 8px rgba(255, 255, 255, 0.3);
      line-height: 1.5;
    }

    /* Effets de particules subtiles */
    #chat-window::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 30%, rgba(100, 150, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(150, 100, 255, 0.1) 0%, transparent 50%);
      pointer-events: none;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      #chat-window {
        width: calc(100vw - 40px);
        left: 20px;
        right: 20px;
      }
      
      #dialogue-box {
        min-width: calc(100vw - 40px);
        left: 20px;
        right: 20px;
        transform: none;
      }
    }
  </style>
</head>
<body>
  <!-- Chat Toggle Button (appears when chat is hidden) -->
  <div id="chat-toggle">
    <span id="chat-toggle-icon">üí¨</span>
  </div>

  <!-- Chat Window -->
  <div id="chat-window">
    <div id="chat-header">
      <div id="chat-title">
        <span>üí¨ Global Chat</span>
        <div class="sound-wave"></div>
        <div class="sound-wave"></div>
        <div class="sound-wave"></div>
      </div>
      <div id="chat-controls">
        <span id="online-count">üü¢ 42 online</span>
        <button class="chat-btn" id="minimize-btn">‚àí</button>
        <button class="chat-btn" id="hide-btn">‚Üê</button>
        <button class="chat-btn" id="settings-btn">‚öôÔ∏è</button>
      </div>
    </div>
    
    <div id="chat-messages"></div>
    
    <div id="typing-indicator">
      <span class="typing-dots">PikachuMaster is typing</span>
    </div>
    
    <div id="chat-input-container">
      <input id="chat-input" type="text" placeholder="Type your message and press Enter..." autocomplete="off" maxlength="200" />
      <span id="char-counter">200</span>
    </div>
  </div>

  <!-- NPC Dialogue Box -->
  <div id="dialogue-box" style="display:none;">
    <div id="npc-portrait"></div>
    <div id="npc-dialogue">
      <span id="npc-name"></span>
      <span id="npc-text"></span>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // === Chat Enhancement System ===
    
    class PokeChatSystem {
      constructor() {
        this.chatMessages = document.getElementById('chat-messages');
        this.chatInput = document.getElementById('chat-input');
        this.charCounter = document.getElementById('char-counter');
        this.typingIndicator = document.getElementById('typing-indicator');
        this.chatWindow = document.getElementById('chat-window');
        this.chatToggle = document.getElementById('chat-toggle');
        this.minimizeBtn = document.getElementById('minimize-btn');
        this.hideBtn = document.getElementById('hide-btn');
        this.onlineCount = document.getElementById('online-count');
        
        this.maxMessages = 50;
        this.isMinimized = false;
        this.isHidden = false;
        this.typingTimeout = null;
        this.messageHistory = [];
        
        this.pokemonEmojis = ['‚ö°', 'üî•', 'üíß', 'üå±', 'üåü', 'üëª', 'ü¶ã', 'üêâ', '‚≠ê', 'üíé'];
        this.currentOnline = 42;
        
        this.initializeEventListeners();
        this.simulateActivity();
      }
      
      initializeEventListeners() {
        // Input handling
        this.chatInput.addEventListener('input', (e) => this.handleInput(e));
        this.chatInput.addEventListener('keypress', (e) => this.handleKeyPress(e));
        this.chatInput.addEventListener('focus', () => this.showTypingIndicator());
        this.chatInput.addEventListener('blur', () => this.hideTypingIndicator());
        
        // Chat controls
        this.minimizeBtn.addEventListener('click', () => this.toggleMinimize());
        this.hideBtn.addEventListener('click', () => this.toggleHide());
        this.chatToggle.addEventListener('click', () => this.toggleHide());
        document.getElementById('settings-btn').addEventListener('click', () => this.showSettings());
        
        // Header click to toggle (only if minimized)
        document.getElementById('chat-header').addEventListener('click', () => {
          if (this.isMinimized) this.toggleMinimize();
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
          if (e.ctrlKey && e.key === 'h') {
            e.preventDefault();
            this.toggleHide();
          }
          if (e.ctrlKey && e.key === 'm') {
            e.preventDefault();
            if (!this.isHidden) this.toggleMinimize();
          }
        });
      }
      
      handleInput(e) {
        const length = e.target.value.length;
        const remaining = 200 - length;
        
        this.charCounter.textContent = remaining;
        this.charCounter.className = '';
        
        if (remaining < 50) this.charCounter.classList.add('warning');
        if (remaining < 20) this.charCounter.classList.add('danger');
        
        // Simulate typing indicator for other users
        if (length > 0) {
          this.showTypingIndicator('You are typing');
          clearTimeout(this.typingTimeout);
          this.typingTimeout = setTimeout(() => this.hideTypingIndicator(), 2000);
        }
      }
      
      handleKeyPress(e) {
        if (e.key === 'Enter' && this.chatInput.value.trim()) {
          this.sendMessage(this.chatInput.value.trim());
          this.chatInput.value = '';
          this.charCounter.textContent = '200';
          this.charCounter.className = '';
        }
      }
      
      sendMessage(text) {
        // Add random Pokemon emoji occasionally
        if (Math.random() < 0.3) {
          const emoji = this.pokemonEmojis[Math.floor(Math.random() * this.pokemonEmojis.length)];
          text += ` <span class="pokemon-emoji">${emoji}</span>`;
        }
        
        this.addMessage('You', text, null, 'normal');
        this.hideTypingIndicator();
        
        // Simulate responses
        setTimeout(() => this.simulateResponse(), 1000 + Math.random() * 3000);
      }
      
      addMessage(username, text, timestamp = null, type = 'normal') {
        console.log('Adding message:', { username, text, type }); // Debug
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message new`;
        
        // Add type class if not normal
        if (type !== 'normal') {
          messageDiv.classList.add(type);
        }
        
        const time = timestamp || new Date().toLocaleTimeString('en-US', { 
          hour: '2-digit', 
          minute: '2-digit',
          hour12: true
        });
        
        if (type === 'system') {
          messageDiv.innerHTML = `
            <span class="chat-text">${text}</span>
            <span class="chat-timestamp">${time}</span>
          `;
        } else {
          // Normal user message (including "You")
          let levelBadge = '';
          if (username === 'You') {
            levelBadge = ' level" data-level="Lv.25"';
          } else if (Math.random() < 0.7) {
            const level = Math.floor(Math.random() * 50) + 1;
            levelBadge = ` level" data-level="Lv.${level}"`;
          } else {
            levelBadge = '"';
          }
          
          messageDiv.innerHTML = `
            <span class="chat-username${levelBadge}>${username}</span>
            <span class="chat-text">${text}</span>
            <span class="chat-timestamp">${time}</span>
          `;
        }
        
        console.log('Message HTML:', messageDiv.outerHTML); // Debug
        console.log('Message classes:', messageDiv.className); // Debug
        
        this.chatMessages.appendChild(messageDiv);
        this.scrollToBottom();
        
        // Remove animation class
        setTimeout(() => messageDiv.classList.remove('new'), 400);
        
        // Manage message limit
        this.messageHistory.push(messageDiv);
        if (this.messageHistory.length > this.maxMessages) {
          const oldMessage = this.messageHistory.shift();
          oldMessage.classList.add('leaving');
          setTimeout(() => oldMessage.remove(), 300);
        }
        
        // Play sound effect (simulation)
        this.playMessageSound();
      }
      
      scrollToBottom() {
        this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
      }
      
      showTypingIndicator(text = 'PikachuMaster is typing') {
        this.typingIndicator.querySelector('.typing-dots').textContent = text;
        this.typingIndicator.classList.add('show');
      }
      
      hideTypingIndicator() {
        this.typingIndicator.classList.remove('show');
      }
      
      toggleMinimize() {
        console.log('Minimize clicked, current state:', this.isMinimized); // Debug
        if (this.isHidden) return; // Can't minimize when hidden
        
        this.isMinimized = !this.isMinimized;
        this.chatWindow.classList.toggle('minimized', this.isMinimized);
        this.minimizeBtn.textContent = this.isMinimized ? '+' : '‚àí';
        
        console.log('New minimize state:', this.isMinimized); // Debug
        
        if (!this.isMinimized) {
          // Focus input when expanding
          setTimeout(() => this.chatInput.focus(), 100);
        }
      }
      
      toggleHide() {
        console.log('Hide clicked, current state:', this.isHidden); // Debug
        this.isHidden = !this.isHidden;
        this.chatWindow.classList.toggle('hidden', this.isHidden);
        this.chatToggle.classList.toggle('show', this.isHidden);
        
        // Reset minimized state when showing
        if (!this.isHidden && this.isMinimized) {
          this.isMinimized = false;
          this.chatWindow.classList.remove('minimized');
          this.minimizeBtn.textContent = '‚àí';
        }
        
        console.log('New hide state:', this.isHidden); // Debug
        
        // Focus input when showing
        if (!this.isHidden) {
          setTimeout(() => this.chatInput.focus(), 500);
        }
      }
      
      showSettings() {
        // Placeholder for settings menu
        this.addMessage('System', '‚öôÔ∏è Settings: Ctrl+H to hide/show, Ctrl+M to minimize', null, 'system');
      }
      
      simulateResponse() {
        const responses = [
          'Great battle! Good game! üéÆ',
          'Looking for rare Pokemon trades! üíé',
          'Anyone know where to find Mewtwo? ü§î',
          'Just caught a shiny Pikachu! ‚ö°‚ú®',
          'Gym battle in 5 minutes, who\'s in? ‚öîÔ∏è',
          'Thanks for the trade! üëç',
          'This game is awesome! üåü'
        ];
        
        const users = ['PikachuMaster', 'TeamRocket_James', 'MistyWaterLily', 'BrockTheRock', 'AshKetchum92'];
        const user = users[Math.floor(Math.random() * users.length)];
        const response = responses[Math.floor(Math.random() * responses.length)];
        
        this.showTypingIndicator(`${user} is typing`);
        setTimeout(() => {
          this.addMessage(user, response);
          this.hideTypingIndicator();
        }, 1000 + Math.random() * 2000);
      }
      
      simulateActivity() {
        // Simulate online count changes
        setInterval(() => {
          const change = Math.floor(Math.random() * 6) - 2; // -2 to +3
          this.currentOnline = Math.max(20, Math.min(100, this.currentOnline + change));
          this.onlineCount.textContent = `üü¢ ${this.currentOnline} online`;
        }, 10000);
        
        // Simulate random system messages
        setTimeout(() => {
          this.addMessage('System', 'üéâ Daily tournament starting in 10 minutes!', null, 'system');
        }, 15000);
        
        // Simulate automatic responses
        setTimeout(() => {
          this.addMessage('Professor_Oak', 'Welcome to the world of Pok√©mon! üåü', null, 'normal');
        }, 3000);
        
        setTimeout(() => {
          this.addMessage('Nurse_Joy', 'Don\'t forget to heal your Pok√©mon regularly! üíä', null, 'normal');
        }, 8000);
      }
      
      playMessageSound() {
        // Simulate sound effect with visual feedback
        const soundWaves = document.querySelectorAll('.sound-wave');
        soundWaves.forEach(wave => {
          wave.style.animation = 'none';
          setTimeout(() => wave.style.animation = 'soundWave 1s infinite ease-in-out', 10);
        });
      }
    }
    
    // === NPC Dialogue System ===
    function showNpcDialogue({ portrait, name, text }) {
      const box = document.getElementById("dialogue-box");
      const npcPortrait = document.getElementById("npc-portrait");
      const npcName = document.getElementById("npc-name");
      const npcText = document.getElementById("npc-text");
      
      box.style.display = "flex";
      npcPortrait.innerHTML = portrait
        ? `<img src="${portrait}" alt="${name}" style="max-width:80px;max-height:80px;">`
        : "";
      npcName.innerText = name || "";
      npcText.innerText = text || "";
      
      box.onclick = () => (box.style.display = "none");
    }
    
    // Initialize chat system
    const pokeChat = new PokeChatSystem();

  pokeChat.addMessage('System', 'üéÆ Welcome to PokeWorld! Press T to test NPC dialogue.', null, 'system');
  pokeChat.addMessage('KantoTrainer', 'Anyone up for a battle? <span class="pokemon-emoji">‚ö°</span>', null, 'normal');

    
    // Test NPC dialogue (press 't' to test)
    document.addEventListener('keypress', function(e) {
      if (e.key === 't' || e.key === 'T') {
        showNpcDialogue({
          portrait: 'https://via.placeholder.com/80x80/4a90e2/ffffff?text=OAK',
          name: 'Professor Oak',
          text: 'Hello young trainer! Ready for your Pok√©mon adventure? Press here to close this dialogue.'
        });
      }
    });
  </script>
  <script type="module" src="/src/main.js"></script>
</body>
</html>
